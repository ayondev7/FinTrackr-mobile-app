generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id              String        @id @default(uuid())
  name            String
  email           String        @unique
  password        String?
  image           String?
  providerId      String?       @unique
  currency        String        @default("USD")
  initialBalance  Float         @default(0)
  currentBalance  Float         @default(0)
  theme           String        @default("light")
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  wallets         Wallet[]
  categories      Category[]
  transactions    Transaction[]
  budgets         Budget[]

  @@index([email])
  @@index([providerId])
  @@map("users")
}

model Wallet {
  id              String        @id @default(uuid())
  userId          String
  name            String
  type            String
  balance         Float         @default(0)
  icon            String
  color           String
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions    Transaction[]

  @@index([userId])
  @@map("wallets")
}

model Category {
  id              String        @id @default(uuid())
  userId          String
  name            String
  icon            String
  color           String
  type            String
  isPinned        Boolean       @default(false)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  subCategories   SubCategory[]
  transactions    Transaction[]
  budgets         Budget[]

  @@index([userId])
  @@index([type])
  @@index([userId, type])
  @@map("categories")
}

model SubCategory {
  id              String        @id @default(uuid())
  categoryId      String
  name            String
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  category        Category      @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@index([categoryId])
  @@map("sub_categories")
}

model Transaction {
  id                    String    @id @default(uuid())
  userId                String
  type                  String
  amount                Float
  categoryId            String
  walletId              String?
  name                  String?
  description           String?
  date                  DateTime
  isRecurring           Boolean   @default(false)
  recurringFrequency    String?
  nextDueDate           DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  category              Category  @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  wallet                Wallet?   @relation(fields: [walletId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([categoryId])
  @@index([walletId])
  @@index([date])
  @@index([type])
  @@index([userId, date])
  @@index([userId, type])
  @@index([isRecurring])
  @@map("transactions")
}

model Budget {
  id              String    @id @default(uuid())
  userId          String
  categoryId      String
  limit           Float
  spent           Float     @default(0)
  period          String
  startDate       DateTime
  endDate         DateTime
  alertThreshold  Float     @default(80)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  category        Category  @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([categoryId])
  @@index([userId, period])
  @@index([startDate, endDate])
  @@map("budgets")
}
